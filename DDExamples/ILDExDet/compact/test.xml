<lccdd xmlns:compact="http://www.lcsim.org/schemas/compact/1.0" 
    xmlns:xs="http://www.w3.org/2001/XMLSchema" 
    xs:noNamespaceSchemaLocation="http://www.lcsim.org/schemas/compact/1.0/compact.xsd">

    <info name="clic_sid_cdr"
        title="CLIC Silicon Detector CDR"
        author="Christian Grefe"
        url="https://twiki.cern.ch/twiki/bin/view/CLIC/ClicSidCdr"
        status="development"
        version="$Id: compact.xml,v 1.3 2010/12/02 16:34:00 grefe Exp $">
        <comment>The compact format for the CLIC Silicon Detector used for the conceptual design report</comment>        
    </info>
  
    <includes>
        <gdmlFile  ref="elements.xml"/>
        <gdmlFile  ref="materials.xml"/>
        <pyBuilder ref="../drivers"/>
    </includes>
  
    <define>
        <constant name="world_side"              value="10*m"/>
        <constant name="world_x"                 value="world_side/2"/>
        <constant name="world_y"                 value="world_side/2"/>
        <constant name="world_z"                 value="world_side/2"/>        
        <constant name="CrossingAngle"           value="0.020*rad"/>
        <constant name="ILC_Main_Crossing_Angle" value="CrossingAngle"/>
        
        <constant name="TPC_zhalf"              value="2500*mm"/>
        <constant name="TPC_outer_radius"       value="1808*mm"/>
        <constant name="TPC_inner_radius"       value="350*mm"/>
        <constant name="TPC_inner_thickness"    value="2*mm"/>
        <constant name="TPC_outer_thickness"    value="3*mm"/>
        <constant name="TPC_endcap_thickness"   value="3*mm"/>

        <constant name="tracking_region_radius" value="TPC_outer_radius + 1.0*m"/>
        <constant name="tracking_region_zmax"   value="TPC_zhalf + 1.0*m"/>
        <constant name="SolenoidCoilOuterZ"     value="TPC_zhalf + 0.3*m"/>
        <constant name="SolenoidalFieldRadius"  value="TPC_outer_radius+0.2*m"/>


        <!--                  Shared parameters                      -->
        <constant name="Ecal_TPC_gap"                          value="35*mm"/>
        <constant name="Ecal_Lcal_ring_gap"                    value="-48*mm"/>

        <constant name="TPC_Ecal_Hcal_barrel_halfZ"            value="2730*mm"/>
        <constant name="TPC_Ecal_gap"                          value="10*mm"/>
        <constant name="Ecal_endcap_zmax"                      value="2500*mm"/>
        <constant name="Ecal_outer_radius"                     value="1910*mm"/>

        <constant name="Hcal_Ecal_gap"                         value="26*mm"/>
        <constant name="Hcal_R_max"                            value="3000*mm"/>
        <constant name="Hcal_Ecal_gap"                         value="26*mm"/>
        <constant name="Yoke_barrel_inner_radius"              value="4450*mm"/>


        <!--                  Shared parameters                      -->
        <constant name="Lcal_outer_radius"                     value="290*mm"/>
        <constant name="TPC_Ecal_Hcal_barrel_halfZ"            value="2730*mm"/>
        <constant name="TPC_Ecal_gap"                          value="10*mm"/>
        <constant name="Ecal_endcap_zmax"                      value="2500*mm"/>
        <constant name="Ecal_outer_radius"                     value="1910*mm"/>

        <constant name="Hcal_Ecal_gap"                         value="26*mm"/>
        <constant name="Hcal_R_max"                            value="3000*mm"/>
        <constant name="Hcal_Ecal_gap"                         value="26*mm"/>
        <constant name="Yoke_barrel_inner_radius"              value="4450*mm"/>

        <!--                   FTD parameters                        -->
        <constant name="Ftd_total_cylinder_thickness"          value="1*mm"/>
        <constant name="Ftd_cables_thickness"                  value="0.08*mm"/>
        <constant name="Ftd_Si_thickness1"                     value="0.3*mm"/>
        <constant name="Ftd_Si_thickness2"                     value="0.3*mm"/>
        <constant name="Ftd_inner_support_thickness"           value="2*mm"/>
        <constant name="Ftd_inner_support_length"              value="4*mm"/>
        <constant name="Ftd_outer_support_thickness"           value="10*mm"/>
        <constant name="Ftd_outer_support_length"              value="4*mm"/>

        <!--                   TPC02 parameters                      -->
        <constant name="TPC_inner_radius"                      value="320*mm"/>
        <constant name="TPC_outer_radius"                      value="1690*mm"/>
        <constant name="TPC_zhalf"                             value="TPC_Ecal_Hcal_barrel_halfZ"/>
        <constant name="TPC_electronics_backend_thickness"     value="230*mm"/>
        <constant name="TPC_inner_wall_thickness"              value="1.16*mm"/>
        <constant name="TPC_outer_wall_thickness"              value="1.51*mm"/>
        <constant name="TPC_sensitive_inner_gap"               value="66*mm"/>
        <constant name="TPC_sensitive_outer_gap"               value="64*mm"/>
        <constant name="TPC_fch_thickness"                     value="0.3*mm"/>


        <!--                   COIL00 parameters                     -->
        <constant name="Coil_thickness"                        value="850*mm"/>
        <constant name="Coil_extra_size"                       value="2520*mm"/>
        <constant name="Coil_inner_radius"                     value="Hcal_R_max"/>
        <constant name="Coil_outer_radius"                     value="Hcal_R_max+Coil_thickness"/>
        <constant name="Coil_half_z"                           value="TPC_Ecal_Hcal_barrel_halfZ+Coil_extra_size"/>

        <!--                   Yoke02 parameters                     -->
        <constant name="Yoke_Z_start_endcaps"                  value="6625*mm"/>
        <constant name="Yoke_barrel_inner_radius"              value="4450*mm"/>
        <constant name="Yoke_thickness"                        value="2000*mm"/>
        <constant name="Yoke_endcap_inner_radius"              value="240.50*mm"/>
        <constant name="Yoke_symmetry"                         value="8"/>
        <constant name="Yoke_Barrel_Half_Z"                    value="TPC_Ecal_Hcal_barrel_halfZ+Coil_extra_size+Yoke_thickness+20*mm"/>
        <!--                  SEcal03 parameters                      -->
        <constant name="Ecal_lateral_face_thickness"           value="2*mm"/>
        <constant name="Ecal_front_face_thickness"             value="3*mm"/>
        <constant name="Ecal_fiber_thickness"                  value="0.2*mm"/>
        <constant name="Ecal_guard_ring_size"                  value="1*mm"/>
        <constant name="Ecal_cell_size"                        value="4.9*mm"/>
        <constant name="Ecal_Alveolus_Air_Gap"                 value="0.25*mm"/>
        <constant name="Ecal_support_thickness"                value="9.3*mm"/>
        <constant name="Ecal_Slab_PCB_thickness"               value="0.8*mm"/>
        <constant name="Ecal_Slab_copper_thickness"            value="0.2*mm"/>
        <constant name="Ecal_Slab_shield_thickness"            value="0.15*mm"/>
        <constant name="Ecal_Slab_ground_thickness"            value="0.05*mm"/>
        <constant name="Ecal_Slab_glue_gap"                    value="0.1*mm"/>
        <constant name="Ecal_Si_thickness"                     value="0.5*mm"/>

        <constant name="Ecal_EC_ring_gap"                      value="10*mm"/>

        <constant name="Ecal_Barrel_halfZ"                     value="2350*mm"/>
        <constant name="Ecal_barrel_number_of_towers"          value="5"/>
        <constant name="Ecal_endcap_extra_size"                value="60.8*mm"/>
        <constant name="Ecal_endcap_center_box_size"           value="600*mm"/>
        <constant name="Ecal_H_fiber_thickness"                value="0.30*mm"/>
        <constant name="Ecal_cells_size"                       value="4.9*mm"/>
        <constant name="Ecal_endcap_zmax"                      value="1825*mm"/>
        <constant name="Ecal_endcap_zmin"                      value="2329*mm"/>
        <constant name="Ecal_nlayers1"                         value="20"/>
        <constant name="Ecal_nlayers2"                         value="10"/>
        <constant name="Ecal_nlayers3"                         value="0"/>
        <constant name="Ecal_radiator_layers_set1_thickness"   value="2.1*mm"/>
        <constant name="Ecal_radiator_layers_set2_thickness"   value="4.2*mm"/>
        <constant name="Ecal_radiator_layers_set3_thickness"   value="0*mm"/>
    </define>

    <materials>
        <material formula="Si" name="silicon_2.33gccm" state="solid" >
          <RL type="X0" unit="cm" value="9.36607" />
          <NIL type="lambda" unit="cm" value="45.7531" />
          <D type="density" unit="g/cm3" value="2.33" />
          <composite n="1" ref="Si" />
        </material>

        <material name="silicon_8.72gccm" state="solid" >
          <RL type="X0" unit="cm" value="9.36607" />
          <NIL type="lambda" unit="cm" value="45.7531" />
          <D type="density" unit="g/cm3" value="8.72" />
          <composite n="1" ref="Si" />
        </material>

        <material formula="W" name="tungsten_19.3gccm" state="solid" >
          <RL type="X0" unit="cm" value="0.350418" />
          <NIL type="lambda" unit="cm" value="10.3057" />
          <D type="density" unit="g/cm3" value="19.3" />
          <composite n="1" ref="W" />
        </material>

        <material name="TPCEndcapMaterial" state="solid">
          <!-- density calculated internally  -->
          <!-- D type="density" unit="g/cm3" value="19.3" -->
          <composite n="0.1244" ref="Kapton"/>
          <composite n="0.0156" ref="Copper"/>
          <composite n="0.86"   ref="Air"/>
        </material>

        <material name="Graphite">
        	<D value="1.7" unit="g/cm3"/>
        	<composite n="1" ref="C"/>
        </material>      
    </materials>
  
    <limits>

        <limitset name="cal_limits">
            <limit name="step_length_max" particles="*" value="5.0" unit="mm" />
        </limitset>

        <limitset name="EcalLimits">
            <limit name="step_length_max" particles="*" value="5.0" unit="mm" />
        </limitset>

    </limits>

    <display>

      <vis name="FtdCylinderVis"       alpha="1.0" r="0.5" g="0.5"  b="0.5"     drawingStyle="wireframe" showDaughters="true"  visible="true"/>
      <vis name="FtdCablesVis"         alpha="1.0" r="0.75" g="0"   b="0.0"    drawingStyle="solid"     showDaughters="true"  visible="true"/>
      <vis name="FtdDiskVis"           alpha="1.0" r="0.0"  g="0"    b="0.75"   drawingStyle="solid"     showDaughters="true"  visible="true"/>

      <vis name="MaskVis"              alpha="1.0" r="0.20" g="0"    b="0"      drawingStyle="solid"     showDaughters="true"  visible="true"/>
      <vis name="MaskYokeVis"          alpha="1.0" r="0.2"  g="0.2"  b="0.2"    drawingStyle="solid"     showDaughters="true"  visible="true"/>
      <vis name="MaskCoilVis"          alpha="1.0" r="0.0"  g="0"    b="0.5"    drawingStyle="solid"     showDaughters="true"  visible="true"/>

      <vis name="TPCVis"               alpha="1.0" r="0.0"  g="0"    b="0.5"    drawingStyle="solid"     showDaughters="true"  visible="true"/>
      <vis name="TPCInnerWallVis"      alpha="1.0" r="0.0"  g="0.5"  b="0.5"    drawingStyle="solid"     showDaughters="true"  visible="true"/>
      <vis name="TPCOuterWallVis"      alpha="1.0" r="0.0"  g="0.5"  b="0.5"    drawingStyle="solid"     showDaughters="true"  visible="true"/>
      <vis name="TPCEndcapVis"         alpha="1.0" r="0.0"  g="0.5"  b="0.5"    drawingStyle="solid"     showDaughters="true"  visible="true"/>
      <vis name="TPCChamberVis"        alpha="1.0" r="1.0"  g="0.5"  b="0.5"    drawingStyle="solid"     showDaughters="true"  visible="true"/>
      <vis name="TPCGasVis"            alpha="1.0" r="1.0"  g="1.0"  b="1.0"    drawingStyle="wireframe" showDaughters="false" visible="true"/>
      <vis name="TPCFchVis"            alpha="1.0" r="0.2"  g="0.0"  b="0.8"    drawingStyle="wireframe" showDaughters="true"  visible="false"/>
      <vis name="TPCLayerVis"          alpha="1.0" r="0.2"  g="0.0"  b="0.8"    drawingStyle="wireframe" showDaughters="true"  visible="false"/>

      <vis name="CoilVis"              alpha="1.0" r="0.0"  g="0.0"  b="0.7"    drawingStyle="wireframe" showDaughters="true"  visible="true"/>
      <vis name="YokeVis"              alpha="1.0" r="0.1"  g="0.8"  b="0.8"    drawingStyle="wireframe" showDaughters="true"  visible="true"/>



      <vis name="EcalVis"              alpha="1.0" r="0.5" g="1" b="0.5"        drawingStyle="wireframe" showDaughters="true"  visible="true"/>
      <vis name="EcalLayerVis"         alpha="1.0" r="1" g="0" b="0"            drawingStyle="solid"     showDaughters="true"  visible="false"/>
      <vis name="EcalPCBVis"           alpha="1.0" r="0.5" g="0.5" b="0"        drawingStyle="wireframe" showDaughters="true"  visible="true"/>
      <vis name="EcalRadiatorVis"      alpha="1.0" r="0" g="1" b="0"            drawingStyle="wireframe" showDaughters="true"  visible="true"/>
      <vis name="EcalTowerVis"         alpha="1.0" r="0" g="0.1" b="0.9"        drawingStyle="solid"     showDaughters="true"  visible="true"/>
      <vis name="EcalRingVis"          alpha="1.0" r="0" g="0" b="1"            drawingStyle="solid"     showDaughters="true"  visible="true"/>
      <vis name="EcalWaferVis"         alpha="1.0" r=".7" g=".7" b=".7"         drawingStyle="solid"                           visible="true"/>
      <vis name="EcalSlabVis"          alpha="1.0" r="1" g="1" b="1"            drawingStyle="wireframe" showDaughters="true"  visible="true"/>
      <vis name="EcalSlabGroundVis"    alpha="1.0" r="0" g="0" b="1"            drawingStyle="wireframe"                       visible="true"/>
      <vis name="EcalSlabSensitiveVis" alpha="1.0" r=".5" g=".5" b=".5"         drawingStyle="wireframe"                       visible="true"/>


    </display>

    <detectors>
        <comment>Trackers</comment>

        <detector id="10" name="ECAL" type="Tesla_SEcal03"
          inner_r="TPC_outer_radius+Ecal_TPC_gap"
          lateral_face_thickness="Ecal_lateral_face_thickness"
          fiber_thickness="Ecal_fiber_thickness"
          guard_ring_size="Ecal_guard_ring_size"
          cell_size="Ecal_cell_size"
          alveolus_gap="Ecal_Alveolus_Air_Gap"
        >
          <support   thickness="Ecal_support_thickness"/>
          <front     thickness="Ecal_front_face_thickness"/>
          <pcbshield thickness="Ecal_Slab_PCB_thickness + Ecal_Slab_copper_thickness + Ecal_Slab_shield_thickness" vis="EcalPCBVis" material="G10"/>
          <barrel    zhalf="Ecal_Barrel_halfZ" 
                     towers="Ecal_barrel_number_of_towers"
                     radiatorMaterial="tungsten_19.3gccm"
                     material="g10"
                     vis="EcalVis"/>
          <endcap    inner_r="Lcal_outer_radius + Ecal_Lcal_ring_gap"
                     ring_gap="Ecal_EC_ring_gap"
                     extra_size="Ecal_endcap_extra_size"
                     center_box_size="Ecal_endcap_center_box_size"/>

          <layer id="1" repeat="Ecal_nlayers1" thickness="Ecal_radiator_layers_set1_thickness" material="tungsten_19.3gccm"/>
          <layer id="2" repeat="Ecal_nlayers2" thickness="Ecal_radiator_layers_set2_thickness" material="tungsten_19.3gccm"/>
          <layer id="3" repeat="Ecal_nlayers3" thickness="Ecal_radiator_layers_set3_thickness" material="tungsten_19.3gccm"/>
          <slab h_fiber_thickness="Ecal_H_fiber_thickness">
            <shielding thickness="Ecal_Slab_shield_thickness"/>
            <copper    thickness="Ecal_Slab_copper_thickness" material="Cu"/>
            <ground    thickness="Ecal_Slab_ground_thickness" material="Cu"/>
            <glue      thickness="Ecal_Slab_glue_gap"/>
            <sensitive thickness="Ecal_Si_thickness" material="silicon_2.33gccm"/>
          </slab>
        </detector>

        <!--                  Hcal04 description
        -->
<!--
        <constant name="Yoke_symmetry"                         value="8"/>
        <constant name="Hcal_radiator_thickness"               value="20*mm"/>
        <constant name="Hcal_stave_gaps"                       value="3*mm"/>
        <constant name="Hcal_back_plate_thickness"             value="30*mm"/>
        <constant name="Hcal_barrel_end_module_type"           value="2"/>
        <constant name="Hcal_endcap_cables_gap"                value="214*mm"/>
        <constant name="Hcal_endcap_center_box_size"           value="600*mm"/>
        <constant name="Hcal_lateral_structure_thickness"      value="10*mm"/>
        <constant name="Hcal_nlayers"                          value="8"/>
        <constant name="Hcal_outer_radius"                     value="3000*mm"/>
        <constant name="Hcal_modules_gap"                      value="2*mm"/>
        <constant name="Hcal_fiber_gap"                        value="1.5*mm"/>
        <constant name="Hcal_cells_size"                       value="*mm"/>
        <constant name="Hcal_fe_dim_y"                         value="Hcal_radiator_thickness"/>

        <constant name="Hcal_chamber_thickness"                value="6.5*mm"/>
        <constant name="Hcal_total_z_size"                     value="140*mm + 2*TPC_Ecal_Hcal_barrel_halfZ"/>
        <constant name="Hcal_normal_dim_z"                     value="Hcal_total_z_size/5*1080/1120"/>
        <constant name="Hcal_top_end_dim_z"                    value="(Hcal_total_z_size-3*Hcal_normal_dim_z)/2"/>
        <constant name="Hcal_start_z"                          value="1.5*Hcal_normal_dim_z + Hcal_top_end_dim_z + 2*Hcal_modules_gap + Hcal_cables_gap"/>
        <constant name="Hcal_total_dim_y"                      value="Hcal_nlayers*(Hcal_fe_dim_y+Hcal_chamber_tickness) + Hcal_back_plate_thickness"/>
        <constant name="Hcal_inner_radius"                     value="Ecal_outer_radius + Hcal_Ecal_gap"/>
        <constant name="Hcal_module_radius"                    value="Hcal_inner_radius+Hcal_total_dim_y"/>

        <constant name="Hcal_y_dim2_for_x"                     value="Hcal_module_radius*(1-cos(3.141/8) - Hcal_stave_gaps"/>
        <constant name="Hcal_y_dim1_for_x"                     value="Hcal_total_dim_y - Hcal_y_dim2_for_x"/>
        <constant name="Hcal_bottom_dim_x"                     value="2*Hcal_y_dim1_for_x*tan(3.141/8) - Hcal_stave_gaps"/>
        <constant name="Hcal_middle_dim_x"                     value="Hcal_bottom_dim_x+2*Hcal_y_dim1_for_x*tan(3.141/8)"/>
        <constant name="Hcal_top_dim_x"                        value="Hcal_middle_dim_x-2*Hcal_y_dim2_for_x/tan(3.141/8)"/>

        <constant name="Hcal_y_dim1_for_z"                     value="134.8"/>
        <constant name="Hcal_y_dim2_for_z"                     value="(Hcal_top_end_dim_z-Hcal_normal_dim_z)*tan(39.28/2/3.141)"/>
        <constant name="Hcal_y_dim3_for_z"                     value="Hcal_total_dim_y-Hcal_y_dim1_for_z-Hcal_y_dim2_for_z"/>
        <constant name="Hcal_regular_chamber_dim_z"            value="Hcal_normal_dim_z - 2*(Hcal_lateral_plate_thickness)"/>
        <constant name="Hcal_cell_dim_z"                       value="Hcal_regular_chamber_dim_z / FLOOR(Hcal_regular_chamber_dim_z/Hcal_cell_dim_x)"/>

      <vis name="HcalMdoduleVis"       alpha="1.0" r="0.8"  g="0.8"  b="0.2"    drawingStyle="solid"     showDaughters="true"  visible="true"/>
      <vis name="Hcal"        alpha="1.0" r="1.0"  g="0.5"  b="0.5"    drawingStyle="solid"     showDaughters="true"  visible="true"/>
        <detector id="9" name="Hcal" type="Tesla_hcal04" vis="HcalVis">
           <params
                   fe_dim_y="Hcal_fe_dim_y"
                   RadiatorMaterial="Iron"
                   SensitiveModel="scintillator"
                   back_plate_thickness="Hcal_back_plate_thickness"
                   staves_gap="Hcal_stave_gaps"
                   modules_gap="Hcal_modules_gap"
                   nlayers="Hcal_nlayers"
                   barrel_end_module_type="Hcal_barrel_end_module_type"
                   fiber_gap="Hcal_fiber_gap"
                   chamber_tickness="6.5*mm"
                   inner_radius="Hcal_inner_radius"
                   cables_gap="Hcal_endcap_cables_gap"
                   normal_dim_z="Hcal_normal_dim_z"
                   top_end_dim_z="Hcal_top_end_dim_z"
                   start_z="Hcal_start_z"
                   lateral_plate_thickness="Hcal_lateral_plate_thickness"
                   cell_dim_x="Hcal_cell_dim_x"
                   endcap_center_box_size="Hcal_endcap_center_box_size"
                   total_dim_y="Hcal_total_dim_y"
                   module_radius="Hcal_module_radius"
                   y_dim2_for_x="Hcal_y_dim2_for_x"


           />
           <radiator  thickness="Hcal_radiator_thickness" material="Iron"/>
           <sensitive model="scintillator"/>
           <barrel    end_module_type="Hcal_barrel_end_module_type"
                      cell_dim_x="Hcal_cells_size" 
                      center_box_size="Hcal_endcap_center_box_size"/>
           <stave     gap="Hcal_stave_gaps"/>
           <modules   gap="Hcal_modules_gap"/>
           <fibers    gap="Hcal_fiber_gap"/>
           <backplate thickness="Hcal_back_plate_thickness"/>
           <lateral_structure thickness="Hcal_lateral_structure_thickness"/>
           <rpc chamber_thickness="6.5*mm" 
                inner_r="Ecal_outer_radius+Hcal_Ecal_gap"
                cables_gap="Hcal_endcap_cables_gap"
                />
           </rpc>
           <cell x="Hcal_cells_size">
           
      </detector>
-->


    </detectors>


    <readouts>
        <readout name="VXDHits">
            <id>system:6,barrel:3,layer:4,module:16,sensor:1,side:32:-2,strip:20</id>
        </readout>
        <readout name="LcalHits">
            <id>system:6,barrel:3,layer:4,module:16,sensor:1,side:32:-2,strip:20</id>
        </readout>
        <readout name="SITHits">
            <id>system:6,barrel:3,layer:4,module:16,sensor:1,side:32:-2,strip:20</id>
        </readout>
        <readout name="TPCHits">
            <id>system:6,barrel:3,layer:4,module:16,sensor:1,side:32:-2,strip:20</id>
        </readout>
    </readouts>

    <fields>
        <field type="SolenoidMagnet" name="GlobalSolenoid" inner_field="5.0*tesla"
               outer_field="-1.5*tesla" zmax="SolenoidCoilOuterZ"
               outer_radius="SolenoidalFieldRadius" />
    </fields>
</lccdd>
